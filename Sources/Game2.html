<!DOCTYPE html>
<html>
  <head>
    <title>Game 2</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" tyle="text/css" href="style.css">
    <style>
      body  {
        background-color: cornflowerblue;
      }

      div.number  {
        display: none;
      }

      div.box  {
        width: 26px;
        height: 28px;
        top: 64px;
        background: white;
        border-radius: 5px;
        position: absolute;
      }

      div.text  {
        top: 2px;
        left: 7px;
        font-size: 20px;
        color: red;
        position: absolute;
      }

      #attention_box  {
        width: 350px;
        height: 120px;
        top: 350px;
        left: 100px;
        display: none;
         text-align: center;
        background: palegoldenrod;
        justify-content: center;
        align-items: center;
        font-size: 20px;
        border: 5px solid indianred;
        -moz-border-radius: 350px / 120px;
        -webkit-border-radius: 350px / 120px;
        border-radius: 350px / 120px;
        position: absolute;
      }

    </style>
    <script src="resize.js"></script>
  </head>
  <body onload="fixPosition()">
    <div id="container">
      <div id="back_button" style="left: 20px; top: 30px; font-size: 20px; position: absolute;">
        <a href="Main.html" draggable="false">&#60; Back</a>
      </div>
      <div id="displayScore">
        <div class="ball" style="left: 10px; top: 10px"></div>
        <div class="ball" style="left: 35px; top: 10px"></div>
        <div class="ball" style="left: 60px; top: 10px"></div>
        <div class="ball "style="left: 85px; top: 10px"></div>
        <div class="ball"style="left: 110px; top: 10px"></div>
        <div class="ball" style="left: 135px; top: 10px"></div>
        <div class="ball" style="left: 160px; top: 10px"></div>
        <div class="ball" style="left: 185px; top: 10px"></div>
        <div class="ball" style="left: 210px; top: 10px"></div>
      </div>
      <div style="width: 1000px; height: 1px; top: 75px; background: lightgrey; position: absolute"></div>
      <div id="game_display" style="top: 300px; opacity: 0.2">
        <div class="number" style="left: 32px; top: 68px; font-size: 23px; font-weight: bold; display: block">
          0
        </div>
        <div class="number" style="left: 102px;">
          1
        </div>
        <div class="number" style="left: 173px;">
          2
        </div>
        <div class="number" style="left: 243px;">
          3
        </div>
        <div class="number" style="left: 313px;">
          4
        </div>
        <div class="number" style="left: 383px; top: 68px; font-size: 23px; font-weight: bold">
          5
        </div>
        <div class="number" style="left: 453px">
          6
        </div>
        <div class="number" style="left: 523px">
          7
        </div>
        <div class="number" style="left: 593px">
          8
        </div>
        <div class="number" style="left: 663px">
          9
        </div>
        <div class="number" style="left: 725px; top: 68px; font-size: 23px; font-weight: bold">
          10
        </div>
        <div id="line">
          <div style="left: 708px; top: -14px; position: absolute; font-size: 22px">
            >
          </div>
          <div class="point" style="width: 2px"></div>
          <div class="point" style="left: 70px"></div>
          <div class="point" style="left: 140px"></div>
          <div class="point" style="left: 210px"></div>
          <div class="point" style="left: 280px"></div>
          <div class="point" style="width: 2px; left: 350px"></div>
          <div class="point" style="left: 420px"></div>
          <div class="point" style="left: 490px"></div>
          <div class="point" style="left: 560px"></div>
          <div class="point" style="left: 630px"></div>
          <div class="point"></div>
          <div id="highlight" style="height: 4px; top: -2px; left: 0px; background: greenyellow; display: block; position: absolute"></div>
          <div id="dot" onmousedown="mousedown(event)" style="left: 630px; margin-left: -4px; cursor: default;">
            <div style="top: -67px; margin-left: -18px; position: absolute">
              <img id="grasshopper" src="../Picture/grasshopper1.png" draggable="false" style="margin-top: 0px; margin-left: 0px">
            </div>
          </div>
          <div id="box" class="box" style="border: 5px solid gold; margin-left: -15px; top: 30px; color: red; display: none"></div>
        </div>
      </div>
      <div id="start_button" onclick="start()" onmouseover="over()" onmouseout="out()">
        <div id="start_button_1" style="left: 15px; top: 15px; width: 120px; height: 120px; border-radius: 15px; position:relative">
          <img id="start_img" src="../Picture/Start0.png" width="120px" height="120px" style="border-radius: 120px" draggable="false">
        </div>
        <script src="mouse_on_startButton.js"></script>
      </div>
    </div>
    <script>
var start_button = document.getElementById("start_button");
var game_display = document.getElementById("game_display");
var dot = document.getElementById("dot");
var number = document.getElementsByClassName("number");
var box = document.getElementById("box");
var ball = document.getElementsByClassName("ball");
var score = 0;
var index = 0;
var canPress = 0;
var length = 0;
var correct;
var status;
var stage = -1;

function start() {
    status = 1;
    var t = setInterval(show, 20);
    var count = 0;
    function show() {
        if (count == 8) {
            clearInterval(t);
            start_button.style.display = 'none';
            setTimeout(next_question, 200);
        }
        else {
            count++;
            game_display.style.opacity = (count * 0.1) + 0.2;
            start_button.style.opacity = 1 - (count * 0.1);
        }
    }
}
function guide() {
    move_highlight(1);
    setTimeout(function () {
        set_box_block(index + 1);
        setTimeout(function () {
            canPress = 1;
            index += 1;
        }, 100);
    }, 450);
}
addEventListener('keydown', function (ev) {
    if (canPress == 1) {
        console.log(ev.keyCode - 48);
        canPress = 0;
        if (score <= 0) {
            if (ev.keyCode >= 48 && ev.keyCode <= 57) {
                if (ev.keyCode - 48 == index) {
                    number[index].style.display = 'block';
                    setTimeout(set_box_none, 100);
                    setTimeout(function () {
                        if (index == 9) {
                            if (score == 0) {
                                setTimeout(function () {
                                    score_increase();
                                    game_display.style.display = 'none';
                                }, 300);
                                setTimeout(restart, 800);
                                }
                            else {
                                length = 0;
                                highlight.style.width = "0px";
                                for (var i = 1; i < 10; i++)
                                    number[i].style.display = 'none';
                                index = 0;
                                setTimeout(guide, 300);
                            }
                        }
                        else
                            guide();
                    }, 500);
                }
                else {
                    canPress = 1;
                    box.style.border = '3px solid red';
                    box.innerHTML = ev.keyCode - 48;
                    score = -1;
                }
            }
        }
        else {
        }
    }
});

function new_question(){
    correct = 1;
    
    var key = Math.floor(Math.random() * 10);
    set_dot(key);
    make_question(key);
}

function make_question(key){
    addEventListener('keydown' , function(ev) {
        if(status = 1) {
            if(ev.keyCode == key + 48) {
                if(correct == 1) {
                    score_increase();
                    if(score % 3 != 0)  new_question();
                    else restart();
                }
                else new_question();
            }
            else if(ev.keyCode >= 48 && ev.keyCode <= 57) {
                if(correct == 1) {
                    correct = 0;
                    if(score > stage * 3 && score > 1) {
                        score_decrease();
                    }
                    else if(score = 1)  guide();
                }
            }
        }
    })
}



function set_box_block(n) {
    box.style.left = n * 70 + "px";
    box.style.display = 'block';
}
function set_box_none() {
    box.style.display = 'none';
    box.innerHTML = "";
    box.style.border = '3px solid gold';
    }
function restart() {
    status = 0;
    length = 0;
    stage++;
    if(stage == 3)  end();
    highlight.style.width = '0px';
    set_dot(0);
    new_question();
    start_button.style.opacity = 1;
    start_button.style.display = 'block';
    game_display.style.opacity = 0.2;
    game_display.style.display = 'block';
}
function next_question() {
    if (score == 0)
        guide();
    else {
    }
}
function move_highlight(n) {
    var count = 0;
    var t = setInterval(function () {
        if (count == 70 * n)
            clearInterval(t);
        else {
            count += 1;
            length += 1;
            highlight.style.width = length + 'px';
        }
    }, 5);
}
function set_dot(n) {
    dot.style.left = n * 70 - 4 + "px";
}
function end(){
    game_display.style.opacity = 0.2;
    document.getElementById("home_button").style.display = 'block';
}
    </script>
    <script src="change_score.js"></script>
  </body>
</html>
