<!DOCTYPE html>
<html>
    <head>
        <title>Game 3</title>
        <meta charset="UTF-8">
        <link rel="stylesheet" type="text/css" href="style.css">
        <style>
            div.number {
                display:none
            }
            #dot {
                width: 10px;
                height: 10px;
                top: -5px;
                left: -4px;
                border-radius: 6px;
                background: black;
                position: absolute;
            }
            div.text {
                top: 2px;
                left: 7px;
                font-size: 20px;
                color: red;
                position: absolute;
            }
            #OK_button {
                height: 40px;
                width: 90px;
                top: 500px;
                left: 445px;
                border-radius: 150px;
                border: 10px solid lawngreen;
                display: none;
                opacity: 0.3;
                background: #82B366;
                position: absolute;
            }
        </style>
        <script src="resize.js"></script>
    </head>
    <body onload="fixPosition()">
        <div id="container" style="top: 105.333px; left: -425px;">
            <div id="back_button" draggable="false" style="left: 20px; top: 30px; font-size: 20px; position: absolute;">
                <a href="Main.html" draggable="false">< Back</a>
            </div>
            <div id="displayScore">
                <div class="ball" style="left: 10px; top: 10px"></div>
                <div class="ball" style="left: 35px; top: 10px"></div>
                <div class="ball" style="left: 60px; top: 10px"></div>
                <div class="ball " style="left: 85px; top: 10px"></div>
                <div class="ball" style="left: 110px; top: 10px"></div>
                <div class="ball" style="left: 135px; top: 10px"></div>
                <div class="ball" style="left: 160px; top: 10px"></div>
                <div class="ball" style="left: 185px; top: 10px"></div>
                <div class="ball" style="left: 210px; top: 10px"></div>
            </div>
            <div style="width: 1000px; height: 1px; top: 75px; background: lightgrey; position: absolute"></div>
            <div id="game_display" style="top: 300px; opacity: 0.2">
                <div class="number" style="left: 32px; top: 68px; font-size: 23px; font-weight: bold; display: block">0</div>
                <div class="number" style="left: 102px;">1</div>
                <div class="number" style="left: 173px;">2</div>
                <div class="number" style="left: 243px;">3</div>
                <div class="number" style="left: 313px;">4</div>
                <div class="number" style="left: 383px; top: 68px; font-size: 23px; font-weight: bold">5</div>
                <div class="number" style="left: 453px">6</div>
                <div class="number" style="left: 523px">7</div>
                <div class="number" style="left: 593px">8</div>
                <div class="number" style="left: 663px">9</div>
                <div class="number" style="left: 725px; top: 68px; font-size: 23px; font-weight: bold">10</div>
                <div id="line">
                    <div style="left: 708px; top: -14px; position: absolute; font-size: 22px">></div>
                    <div class="point" style="width: 2px"></div>
                    <div class="point" style="left: 70px"></div>
                    <div class="point" style="left: 140px"></div>
                    <div class="point" style="left: 210px"></div>
                    <div class="point" style="left: 280px"></div>
                    <div class="point" style="width: 2px; left: 350px"></div>
                    <div class="point" style="left: 420px"></div>
                    <div class="point" style="left: 490px"></div>
                    <div class="point" style="left: 560px"></div>
                    <div class="point" style="left: 630px"></div>
                    <div class="point" style="width: 2px; left: 700px"></div>
                    <div id="dot" onmousedown="mousedown(event)" style="left: -4px; cursor: default;">
                        <div style="top: -67px; left: -18px; position: absolute">
                            <img id="grasshopper" src="../Picture/grasshopper1.png" draggable="false" style="margin-top: 0px;">
                        </div>
                    </div>
                    <div id="box" class="box" style="border: 5px solid gold; top: 30px; display: none"></div>
                </div>
            </div>
            <div id="start_button" onclick="start()" onmouseover="over()" onmouseout="out()" style="left: 425px; top: 300px; width: 150px; height: 150px">
                <div id="start_button_1" style="left: 15px; top: 15px; width: 120px; height: 120px; border-radius: 15px; position: absolute;">
                    <img id="start_img" src="../Picture/Start0.png" width="120px" height="120px" style="border-radius: 120px" draggable="false">
                </div>
                <script src="mouse_on_startButton.js"></script>
            </div>
            <div id="home_button">
                <p><a href="Main.html"> Go to Lesson </a></p>
            </div>
            <div id="OK_button"></div>
        </div>
        <script>
            var index = 0;
            var box = document.getElementById("box");
            var number = document.getElementsByClassName("number");
            var grasshopper = document.getElementById("grasshopper");
            var start_button = document.getElementById("start_button");
            var dot = document.getElementById("dot");
            var OK_button = document.getElementById("OK_button");
            var x;
            var dot_left = -5;
            var status = 0;
            var canMove = 0;
            var canPress = 0;
            var stage = 0;
            function start() {
                canMove = 0;
                var count = 0;
                var t = setInterval(show, 20);
                function show() {
                    if (count == 8) {
                        clearInterval(t);
                        start_button.style.display = 'none';
                    }
                    else {
                        count ++;
                        game_display.style.opacity = (count * 0.1) + 0.2;
                        start_button.style.opacity = 1 - (count * 0.1);
                    }
                }
                index = 1;
                setTimeout(new_question, 1000);
            }
            function restart() {
                game_display.style.opacity = 0.2;
                stage++;
                index = 0;
                OK_button.style.display = 'block';
                if (stage < 3) {
                    var t = setInterval(move_back_0, 1);
                    start_button.style.opacity = 1;
                    start_button.style.display = 'block';
                }
                else {
                    document.getElementById("home_button").style.display = 'block';
                }
                function move_back_0() {
                    if (dot_left == -4) clearInterval(t);
                    else {
                        dot_left -= 5;
                        dot.style.left = dot_left + "px";
                    }
                }
            }
            function new_question() {
                var count = 0;
                if (stage == 0) {
                    if (index < 6) {
                        var t = setInterval(jump, 5);
                        console.log(index);
                    }
                    else if (index < 10) {
                        make_question();
                    }
                    else restart();
                }
                function jump() {
                    if (count >= 70) {
                        clearInterval(t);
                        make_question();
                    }
                    else {
                        count += 1;
                        dot_left += 1;
                        dot.style.left = dot_left + "px";
                        if (count <= 35) grasshopper.style.marginTop = - (count) + "px";
                        else grasshopper.style.marginTop = - (70 - count) + "px";
                    }
                }
            }
            function make_question() {
                if (stage == 0) {
                    if (index < 6) {
                        setTimeout(set_box_block, 500, index);
                        if (index < 3) setTimeout(correct, 1500);
                        else if (index < 6) {
                            setTimeout(set_box_block, 500, index);
                            setTimeout(canPress = 1, 1000);
                        }
                    }
                    else if (index < 10) {
                        canMove = 1;
                        dot.style.cursor = 'pointer';
                    }
                    else {
                        restart();
                    }
                }
                addEventListener('keydown', function(event) {
                    if (canPress == 1) {
                        if (event.keyCode >= 48 && event.keyCode <= 57) {
                            if (event.keyCode == index + 48) {
                                if (box.style.display == "block") correct();
                            }
                            else {
                                box.innerHTML = event.keyCode - 48;
                            }
                        }
                    }
                });
                function correct() {
                    setTimeout(showAnswer, 0, index);
                    setTimeout(set_box_none, 0);
                    setTimeout(index += 1, 999);
                    setTimeout(new_question, 1000);
                }
            }
            function showAnswer(n) {
                number[n].style.display = 'block';
                console.log("show answer");
            }
            function mousedown(ev) {
                x = ev.x;
                if (canMove == 1) {
                    status = 1;
                    document.getElementById("grasshopper").style.marginTop = "-5px";
                }
                document.addEventListener('mousemove', function (evt) {
                    if (status == 1) {
                        dot_left =  dot_left + event.x - x;
                        x = event.x;
                        if (dot_left < -4) dot.style.left = "-4px";
                        else if (dot_left > 696) dot.style.left = "696px";
                        else dot.style.left = dot_left + "px";
                    }
                });
            }
            addEventListener('mouseup', function () {
                if (status == 1) {
                    status = 0;
                    document.getElementById("grasshopper").style.marginTop = '0px';
                    document.getElementById("grasshopper").src = "../Picture/grasshopper1.png";
                    console.log(dot_left);
                    if (dot_left > 696) {
                        dot_left = 696;
                    }
                    else if (dot_left < -4) {
                        dot_left = -4;
                    }
                    else {
                        var tmp = Math.round((dot_left + 4) / 70) * 70 - 4;
                        console.log(tmp);
                        var change;
                        if (tmp > dot_left) {
                            change = 1;
                        } else change = -1;
                        var t = setInterval(move_to_near, 10);

                        function move_to_near() {
                            if (dot_left == tmp) {
                                clearInterval(t);
                                if (dot_left + 4 == 70 * index) {
                                    canMove = 0;
                                    dot.style.cursor = "default";
                                    setTimeout(set_box_block, 500, index);
                                    setTimeout(canPress = 1, 1000);
                                }
                            } else {
                                dot_left += change;
                                dot.style.left = dot_left + "px";
                            }
                        }
                    }

                }
            });
            function set_box_block(number) {
                box.style.left = number * 70 - 15 + "px";
                box.style.display = 'block';
            }
            function set_box_none() {
                canPress = 0;
                box.innerHTML = "";
                box.style.display = 'none';
            }
        </script>
        <script type= "change_score.js"></script>
    </body>
</html>